#include <cstdio>
#include <cstring>
#include <iostream>
#include <string>

#include "EX.hpp"
#include "LX.hpp"

using std::string;

#define TSTxCTL 0

namespace TDATA
{
constexpr std::pair<const char *, int> INPUTS[] = {
#if 0
  { "1 / 2", 0 },
  { "3 * 2 + 2 / 2", 7 },
  { "((3*(244 - 57 + 4)*(244 - 57 + 4) - (74 - 777)) / (5 - (44 + 77 - "
    "47)*(44 + 77 - 47)*(44 + 77 - 47)) + ((4 + 27)*(3 - 7)))",
    -124 },
  { "1 - 1 - 2", -2 },
  // { "2 + - (- 2 * 2) + - - (- ((1 + 1))) * 1 + (1 * 1)", 5 },
  { "-2", -2 },
  { "2 + - 2 * 2", -2 },
  { "(((7 * (3 + 2)) - (5 * (2 + (6 * 1)))) * ((4 + (9 * (3 - 1))) - (2 * (1"
    "+ 3)))) + (((12 * (8 - (3 * (2 + 1)))) - (5 * (6 - (2 * (1 + (2 * "
    "2)))))) * (3 + (4 * (2 + (1 * 5)))))",
    178 },
  { "2 * 2", 4 },
  { "1 + 2 * 2", 5 },
  { "(1 + 2) * 2", 6 },
  { "1", 1 },
  { "(1)", 1 },
  { "1 + (1 + 1) + 1", 4 },
  { "1 + 1 + (1 + 1) + (((1))) + (((1) + 1))", 7 },
  { "1 - 2 - 3", -4 },
  { "(1 - 2) - (3 - 1)", -3 },
  { "1 - 2", -1 },
  { "2 * 3 * 4", 24 },
  { "2 * -3 * 4", -24 },
  { "2 * -3", -6 },
  { "2 * - -3", 6 },
  { "2 * - (- -3) - 1", -7 },
  { "2 + -3", -1 },
  { "-1", -1 },
  { "-1 + 2", 1 },
  { "- -1 - ((1 + 1)) - 1", -2 },
  { "- (-(1 + 2))", 3 },
  { "- - - 1", -1 },
  { "1 - (2 - (3 + 43)) + 4 - ( 1 + 3   )", 45 },
  { "10 - 5 - 2", 3 },
  { "10 - (5 - 2)", 7 },
  { "(1 + 2) + (3 + 4)", 10 },
  { "(((((5)))))", 5 },
  { "-5 + ((((-(-5)))))", 0 },
  { "0 - 1", -1 },
  { "0 - (1 + 2 + 3)", -6 },
  { "(8 - 3) - (2 - 1)", 4 },
  { "42", 42 },
  { "(7 + 3) - (2 + 1)", 7 },
  { "1 - (2 - (3 - (4 - 5)))", 3 },
  { "1 - 2 - 3 - 4", -8 },
  { "1 - (2 - 3) - 4", -2 },
  { "1 - - 4 * 2 + 1", 10 },
  { "(1 - 2) - (3 - 4)", 0 },
  { "100 - (50 + 25)", 25 },
  { "(100 - 50) + 25", 75 },
  { "1 + (2 + (3 + (4 + 5)))", 15 },
  { "1 - (2 + (3 + (4 + 5)))", -13 },
  { "(1 + 2) - (3 + (4 - 5))", 1 },
  { "((1 + 2) - 3) + (4 - 5)", -1 },
  { "0 - (0 - (0 - (0 - 1)))", 1 },
  { "5 % 3 + 1", 3 },
  { "3 % 2 % 6", 1 },
  { "5 % - - 3 + 1", 3 },
  { "\n\n\n(12 1s 32\n (3) 2123 \n\n234 4\n( 1 2 (3) \n4 5", 3 },
  { "sock", 3 },
  { "1 + -2", -2 },
  { "(1 + 2) + -1 * (1 * (2 * -1) * 1 + ((1 * 1)))", 4 },
#endif
  { "2 - 3 * 4 + 1", 3 },
  { "12 / 3 / 2 + 1", 3 },
  { "(3 + ((((((1)) + 1))))) - (-(1 + 2)) - ((((1))))", 9 },
  { "3 - (-(1 + 2))", 6 },
  { "1 - 1", 1 },
  { "1 - 2 - (3 - (4 + (5 - (6 + (7 - (8 - (9 + (10 - (11 + 12)))))))))", 4 },
  { "1 - 2 * (3 * 3) + 5 * -3", 1 },
  { "2 * - (-3)", -6 },
  { "3 * 5 * 3", 45 },
  { "-1 - 2 * 3 + 3", 5 },
  { "5 % - 3 + 1", 3 },
  { "-1 + (1 + 1) * 1", 3 },
  { "- 2", -2 },
};
}

namespace
{
bool
run ()
{

  AR::Arena arena{};
  for (auto tdata : TDATA::INPUTS)
  {
    const char *input = tdata.first;
    LX::Lexer l{ input, arena, 0, std::strlen (input) };
    (void)l.run ();
    EX::Parser parser{ l };
    parser.run ();
    std::cout << input << " == " << std::to_string (*parser.m_exprs.last ())
              << std::endl;
  }

  return true;
}
}

int
main ()
{
  if (!run ()) { return 1; }
}
